[Skip to main content](#__docusaurus_skipToContent_fallback)

[

![Juicebox Logo](https://docs.juicebox.money/dev/extensions/juice-buyback//img/logo/main-logo-black.svg)

](/)[Docs](/dev/)[Project Creators](/user/)[JuiceboxDAO](/dao/)

[Blogs](/blogs/)

- [For Project Creators](/blog/)
- [Updates](/updates/)
- [Town Halls](/town-hall/)
- [Miscellaneous](/misc/)

[English](#)

- [English](/dev/extensions/juice-buyback/)
- [中文](/zh/dev/extensions/juice-buyback/)

[Links](#)

- [Juicebox](https://juicebox.money)
- [Contact](https://juicebox.money/contact)
- [Discord](https://discord.gg/juicebox)
- [GitHub](https://github.com/jbx-protocol)
- [Telegram](https://t.me/jbx_eth)
- [Governance](https://jbdao.org)
- [Analytics](/dao/reference/analytics/)
- [Twitter](https://twitter.com/juiceboxETH)
- [YouTube](https://www.youtube.com/c/JuiceboxDAO/)
- [Newsletter](https://subscribepage.io/juicenews)
- [Podcast](https://anchor.fm/thejuicecast)

Search⌘K

- [Intro](/dev/)
- [Learn](#)
    
    - [Overview](/dev/learn/overview/)
    - [Architecture](/dev/learn/architecture/)
        
        - [Payment Terminals](/dev/learn/architecture/terminals/)
    - [Administration](/dev/learn/administration/)
    - [Risks](/dev/learn/risks/)
    - [Glossary](/dev/learn/glossary/)
        
        - [Ballot](/dev/learn/glossary/ballot/)
        - [Data source](/dev/learn/glossary/data-source/)
        - [Delegate](/dev/learn/glossary/delegate/)
        - [Discount rate](/dev/learn/glossary/discount-rate/)
        - [Funding cycle](/dev/learn/glossary/funding-cycle/)
        - [Hold fees](/dev/learn/glossary/hold-fees/)
        - [NFT Rewards](/dev/learn/glossary/nft-rewards/)
        - [Operator](/dev/learn/glossary/operator/)
        - [Overflow](/dev/learn/glossary/overflow/)
        - [Payment terminal](/dev/learn/glossary/payment-terminal/)
        - [Project](/dev/learn/glossary/project/)
        - [Redemption rate](/dev/learn/glossary/redemption-rate/)
        - [Reserved tokens](/dev/learn/glossary/reserved-tokens/)
        - [Split allocator](/dev/learn/glossary/split-allocator/)
        - [Splits](/dev/learn/glossary/splits/)
        - [Token Store](/dev/learn/glossary/token-store/)
        - [Tokens](/dev/learn/glossary/tokens/)
- [Build](#)
    
    - [Getting started](/dev/build/getting-started/)
    - [Basics](/dev/build/basics/)
    - [Project NFT](/dev/build/project-nft/)
    - [Programmable treasury](/dev/build/programmable-treasury/)
    - [Treasury extensions](/dev/build/treasury-extensions/)
        
        - [Ballot](/dev/build/treasury-extensions/ballot/)
        - [Data source](/dev/build/treasury-extensions/data-source/)
        - [Pay delegate](/dev/build/treasury-extensions/pay-delegate/)
        - [Redemption delegate](/dev/build/treasury-extensions/redemption-delegate/)
        - [Split allocator](/dev/build/treasury-extensions/split-allocator/)
    - [Utilities](#)
        
        - [Project payer](/dev/build/utilities/project-payer/)
        - [Splits payer](/dev/build/utilities/splits-payer/)
    - [Namespaces & IDs](/dev/build/namespace/)
    - [Contract Examples](/dev/build/examples/)
- [API](#)
    
    - [Data Structures](#)
        
        - [JBDidPayData](/dev/api/data-structures/jbdidpaydata/)
        - [JBDidPayData3_1_1](/dev/api/data-structures/jbdidpaydata3_1_1/)
        - [JBDidRedeemData](/dev/api/data-structures/jbdidredeemdata/)
        - [JBDidRedeemData3_1_1](/dev/api/data-structures/jbdidredeemdata3_1_1/)
        - [JBFee](/dev/api/data-structures/jbfee/)
        - [JBFundAccessConstraints](/dev/api/data-structures/jbfundaccessconstraints/)
        - [JBFundingCycle](/dev/api/data-structures/jbfundingcycle/)
        - [JBFundingCycleData](/dev/api/data-structures/jbfundingcycledata/)
        - [JBFundingCycleMetadata](/dev/api/data-structures/jbfundingcyclemetadata/)
        - [JBGlobalFundingCycleMetadata](/dev/api/data-structures/jbglobalfundingcyclemetadata/)
        - [JBGroupedSplits](/dev/api/data-structures/jbgroupedsplits/)
        - [JBOperatorData](/dev/api/data-structures/jboperatordata/)
        - [JBPayDelegateAllocation](/dev/api/data-structures/jbpaydelegateallocation/)
        - [JBPayDelegateAllocation3_1_1](/dev/api/data-structures/jbpaydelegateallocation3_1_1/)
        - [JBPayParamsData](/dev/api/data-structures/jbpayparamsdata/)
        - [JBProjectMetadata](/dev/api/data-structures/jbprojectmetadata/)
        - [JBRedeemParamsData](/dev/api/data-structures/jbredeemparamsdata/)
        - [JBRedemptionDelegateAllocation](/dev/api/data-structures/jbredemptiondelegateallocation/)
        - [JBRedemptionDelegateAllocation3_1_1](/dev/api/data-structures/jbredemptiondelegateallocation3_1_1/)
        - [JBSplit](/dev/api/data-structures/jbsplit/)
        - [JBSplitAllocationData](/dev/api/data-structures/jbsplitallocationdata/)
        - [JBTokenAmount](/dev/api/data-structures/jbtokenamount/)
    - [Enums](#)
        
        - [JBBallotState](/dev/api/enums/jbballotstate/)
        - [JBFeeType](/dev/api/enums/jbfeetype/)
    - [Libraries](#)
        
        - [JBConstant](/dev/api/libraries/jbconstants/)
        - [JBCurrencies](/dev/api/libraries/jbcurrencies/)
        - [JBFixedPointNumber](/dev/api/libraries/jbfixedpointnumber/)
        - [JBFundingCycleMetadataResolver](/dev/api/libraries/jbfundingcyclemetadataresolver/)
        - [JBGlobalFundingCycleMetadataResolver](/dev/api/libraries/jbglobalfundingcyclemetadataresolver/)
        - [JBOperations](/dev/api/libraries/jboperations/)
        - [JBOperations2](/dev/api/libraries/jboperations2/)
        - [JBSplitsGroups](/dev/api/libraries/jbsplitsgroups/)
        - [JBTokens](/dev/api/libraries/jbtokens/)
    - [Interfaces](#)
        
        - [IJBAllowanceTerminal3_1](/dev/api/interfaces/ijballowanceterminal3_1/)
        - [IJBController3_1](/dev/api/interfaces/ijbcontroller3_1/)
        - [IJBControllerUtility](/dev/api/interfaces/ijbcontrollerutility/)
        - [IJBDirectory](/dev/api/interfaces/ijbdirectory/)
        - [IJBETHERC20ProjectPayerDeployer](/dev/api/interfaces/ijbetherc20projectpayerdeployer/)
        - [IJBETHERC20SplitsPayerDeployer](/dev/api/interfaces/ijbetherc20splitspayerdeployer/)
        - [IJBFeeGauge](/dev/api/interfaces/ijbfeegauge/)
        - [IJBFeeGauge3_1](/dev/api/interfaces/ijbfeegauge3_1/)
        - [IJBFeeHoldingTerminal](/dev/api/interfaces/ijbfeeholdingterminal/)
        - [IJBFundAccessConstraintsStore](/dev/api/interfaces/ijbfundaccessconstraintsstore/)
        - [IJBFundingCycleBallot](/dev/api/interfaces/ijbfundingcycleballot/)
        - [IJBFundingCycleDataSource](/dev/api/interfaces/ijbfundingcycledatasource/)
        - [IJBFundingCycleDataSource3_1_1](/dev/api/interfaces/ijbfundingcycledatasource3_1_1/)
        - [IJBFundingCycleStore](/dev/api/interfaces/ijbfundingcyclestore/)
        - [IJBMigratable](/dev/api/interfaces/ijbmigratable/)
        - [IJBOperatable](/dev/api/interfaces/ijboperatable/)
        - [IJBOperatorStore](/dev/api/interfaces/ijboperatorstore/)
        - [IJBPayDelegate](/dev/api/interfaces/ijbpaydelegate/)
        - [IJBPayDelegate3_1_1](/dev/api/interfaces/ijbpaydelegate3_1_1/)
        - [IJBPaymentTerminal](/dev/api/interfaces/ijbpaymentterminal/)
        - [IJBPayoutRedemptionPaymentTerminal3_1](/dev/api/interfaces/ijbpayoutredemptionpaymentterminal3_1/)
        - [IJBPayoutRedemptionPaymentTerminal3_1_1](/dev/api/interfaces/ijbpayoutredemptionpaymentterminal3_1_1/)
        - [IJBPayoutTerminal3_1](/dev/api/interfaces/ijbpayoutterminal3_1/)
        - [IJBPriceFeed](/dev/api/interfaces/ijbpricefeed/)
        - [IJBPrices](/dev/api/interfaces/ijbprices/)
        - [IJBProjectHandles](/dev/api/interfaces/ijbprojecthandles/)
        - [IJBProjectPayer](/dev/api/interfaces/ijbprojectpayer/)
        - [IJBProjects](/dev/api/interfaces/ijbprojects/)
        - [IJBRedemptionDelegate](/dev/api/interfaces/ijbredemptiondelegate/)
        - [IJBRedemptionDelegate3_1_1](/dev/api/interfaces/ijbredemptiondelegate3_1_1/)
        - [IJBRedemptionTerminal](/dev/api/interfaces/ijbredemptionterminal/)
        - [IJBSingleTokenPaymentTerminal](/dev/api/interfaces/ijbsingletokenpaymentterminal/)
        - [IJBSingleTokenPaymentTerminalStore](/dev/api/interfaces/ijbsingletokenpaymentterminalstore/)
        - [IJBSingleTokenPaymentTerminalStore3_1_1](/dev/api/interfaces/ijbsingletokenpaymentterminalstore3_1_1/)
        - [IJBSplitAllocator](/dev/api/interfaces/ijbsplitallocator/)
        - [IJBSplitsPayer](/dev/api/interfaces/ijbsplitspayer/)
        - [IJBSplitsStore](/dev/api/interfaces/ijbsplitsstore/)
        - [IJBTerminalUtility](/dev/api/interfaces/ijbterminalutility/)
        - [IJBToken](/dev/api/interfaces/ijbtoken/)
        - [IJBTokenStore](/dev/api/interfaces/ijbtokenstore/)
        - [IJBTokenUriResolver](/dev/api/interfaces/ijbtokenuriresolver/)
        - [IJBV1TokenPaymentTerminal](/dev/api/interfaces/ijbv1tokenpaymentterminal/)
    - [Contracts](/dev/api/contracts/)
        
        - [JBProjects](/dev/api/contracts/jbprojects/)
            
            - [Events](#)
                
            - [Properties](#)
                
            - [Read](#)
                
            - [Write](#)
                
        - [JBTokenStore](/dev/api/contracts/jbtokenstore/)
            
        - [JBFundingCycleStore](/dev/api/contracts/jbfundingcyclestore/)
            
        - [JBSplitsStore](/dev/api/contracts/jbsplitsstore/)
            
        - [JBPrices](/dev/api/contracts/jbprices/)
            
        - [JBOperatorStore](/dev/api/contracts/jboperatorstore/)
            
        - [JBToken](/dev/api/contracts/jbtoken/)
            
        - [JBDirectory](/dev/api/contracts/jbdirectory/)
            
        - [JBFundAccessConstraintsStore](/dev/api/contracts/jbfundaccessconstraintsstore/)
        - [JBSingleTokenPaymentTerminalStore3_1](/dev/api/contracts/jbsingletokenpaymentterminalstore3_1/)
        - [JBSingleTokenPaymentTerminalStore3_1_1](/dev/api/contracts/jbsingletokenpaymentterminalstore3_1_1/)
        - [| Payment terminals](#)
            
            - [| Abstract](#)
                
            - [JBERC20PaymentTerminal3_1](/dev/api/contracts/or-payment-terminals/jberc20paymentterminal3_1/)
            - [JBERC20PaymentTerminal3_1_1](/dev/api/contracts/or-payment-terminals/jberc20paymentterminal3_1_1/)
            - [JBERC20PaymentTerminal3_1_2](/dev/api/contracts/or-payment-terminals/jberc20paymentterminal3_1_2/)
            - [JBETHPaymentTerminal3_1](/dev/api/contracts/or-payment-terminals/jbethpaymentterminal3_1/)
            - [JBETHPaymentTerminal3_1_1](/dev/api/contracts/or-payment-terminals/jbethpaymentterminal3_1_1/)
            - [JBETHPaymentTerminal3_1_2](/dev/api/contracts/or-payment-terminals/jbethpaymentterminal3_1_2/)
            - [JBV1TokenPaymentTerminal](/dev/api/contracts/or-payment-terminals/jbv1tokenpaymentterminal/)
                
        - [| Controllers](#)
            
            - [JBController3_1](/dev/api/contracts/or-controllers/jbcontroller3_1/)
        - [| Price Feeds](#)
            
        - [| Ballots](#)
            
        - [| Utilities](#)
            
        - [| Abstract](#)
            
- [Extensions](#)
    
    - [ERC-721 Delegate](/dev/extensions/juice-721-delegate/)
        
        - [Abstract](#)
            
            - [ERC721](/dev/extensions/juice-721-delegate/abstract/erc721/)
            - [JB721Delegate](/dev/extensions/juice-721-delegate/abstract/jb721delegate/)
            - [Votes](/dev/extensions/juice-721-delegate/abstract/votes/)
        - [Enums](#)
            
            - [JB721GovernanceType](/dev/extensions/juice-721-delegate/enums/jb721governancetype/)
        - [Interfaces](#)
            
        - [Libraries](#)
            
        - [Structs](#)
            
        - [JBTiered721Delegate](/dev/extensions/juice-721-delegate/jbtiered721delegate/)
        - [JBTiered721DelegateDeployer](/dev/extensions/juice-721-delegate/jbtiered721delegatedeployer/)
        - [JBTiered721DelegateProjectDeployer](/dev/extensions/juice-721-delegate/jbtiered721delegateprojectdeployer/)
        - [JBTiered721DelegateStore](/dev/extensions/juice-721-delegate/jbtiered721delegatestore/)
        - [JBTiered721GovernanceDelegate](/dev/extensions/juice-721-delegate/jbtiered721governancedelegate/)
    - [Buyback Delegate](/dev/extensions/juice-buyback/)
        
        - [Libraries](#)
            
        - [Interfaces](#)
            
        - [JBBuybackDelegate](/dev/extensions/juice-buyback/jbbuybackdelegate/)
        - [JBGenericBuybackDelegate](/dev/extensions/juice-buyback/jbgenericbuybackdelegate/)
    - [JBDelegateMetadataLib](/dev/extensions/juice-delegate-metadata-lib/)
        
        - [Constants](/dev/extensions/juice-delegate-metadata-lib/jbdelegatemetadataconstants/)
        - [JBDelegateMetadataHelper](/dev/extensions/juice-delegate-metadata-lib/jbdelegatemetadatahelper/)
        - [JBDelegateMetadataLib](/dev/extensions/juice-delegate-metadata-lib/jbdelegatemetadatalib/)
    - [Delegate Registry](/dev/extensions/juice-delegates-registry/)
        
    - [Juice Ownable](/dev/extensions/juice-ownable/)
        
    - [NFT Token Resolver](/dev/extensions/juice-token-resolver/)
        
        - [TokenUriResolver](/dev/extensions/juice-token-resolver/tokenuriresolver/)
        - [DefaultTokenUriResolver](/dev/extensions/juice-token-resolver/defaulttokenuriresolver/)
        - [Interfaces](#)
            
        - [Libraries](#)
            
        - [Data Structures](#)
            
    - [V3 Migration](/dev/extensions/juice-v3-migration/)
        
        - [JBV3Token](/dev/extensions/juice-v3-migration/jbv3token/)
        - [JBV3TokenDeployer](/dev/extensions/juice-v3-migration/jbv3tokendeployer/)
        - [V1Allocator](/dev/extensions/juice-v3-migration/v1allocator/)
        - [V2Allocator](/dev/extensions/juice-v3-migration/v2allocator/)
- [Resources](#)
    
    - [Contract Addresses](/dev/resources/addresses/)
    - [Contribute](/dev/resources/contribute/)
    - [Security & Audits](/dev/resources/security/)
    - [Post Mortems](#)
        
    - [Versioning History](/dev/resources/versioning/)
- [Frontend](/dev/frontend/)
    
- [Deprecated](#)
    

- [](/)
- Extensions
- Buyback Delegate

On this page

# Buyback Delegate

info

This is the README from the [`juice-buyback`](https://github.com/jbx-protocol/juice-buyback.git) repository.

## Summary[​](#summary "Direct link to Summary")

Provides a datasource and delegate which maximise the project token received by the contributor when they call `pay` on the terminal. In order to do so, the delegate will either mint new tokens ("vanilla" path, bypassing the delegate) or swap existing token in an Uniswap V3 pool ("buyback" path), depending on the best quote available at the time of the call.

This first iteration is only compatible with ETH terminals.

## Design[​](#design "Direct link to Design")

### Flow[​](#flow "Direct link to Flow")

- The frontend passes a quote (as an amount received for a given amount send) from the correct Uniswap V3 pool, as well as a maximum slippage allowed (in 1/10000th) while calling `pay(..)`. These should be encoded as uint256 and passed as third and fourth words of the `pay(..)` metadata parameter (the first 2 32bytes being reserved for the protocol). If no quote is provided, a twap is then used.
- `Pay(..)` will use the buyback delegate as datasource and, based on the quote (taking slippage into account) and the funding cycle weight, will either mint (bypassing the delegate and using the regular terminal logic) or swap (signaling this by returning the delegate address and a 0 weight to the terminal).
- If swap is privilegied, the terminal will call the delegate's `didPay` method, which will wrap and swap the eth, and transfer the correct amount of project tokens to the contributor (ie the non-reserved ones). NB: The whole amount contributed will be swapped, including what should be considered as reserved. The delegate will then burn/mint/burn again the non-transfered to account for the reserved tokens (ie burn them all, then mint an amount which will return the correct amount of reserved token, then burn the non-reserved token just minted)
- In case of failure of the swap (eg max slippage, low liquidity), the delegate will mint the tokens instead (using the original funding cycle weight and reserved rate).

### Contracts/Interfaces[​](#contractsinterfaces "Direct link to Contracts/Interfaces")

- BuyBackDelegate: the datasource, pay delegate and uniswap pool callback contract
- BuyBackDelegate3.1.1: the buyback delegate leveraging the new terminal v3.1.1

## Usage[​](#usage "Direct link to Usage")

Anyone can deploy this delegate using the provided forge script. To run this repo, you'll need [Foundry](https://book.getfoundry.sh/) and [NodeJS](https://nodejs.dev/en/learn/how-to-install-nodejs/) installed. Install the dependencies with `npm install && git submodule update --init --force --recursive`, you should then be able to run the tests using `forge test` or deploy a new delegate using `forge script Deploy` (and the correct arguments, based on the chain and key you want to use - see the [Foundry docs](https://book.getfoundry.sh/)).

## Use-case[​](#use-case "Direct link to Use-case")

Maximizing the project token received by the contributor while leveling the funding cycle/secondary market price.

## Risk & trade-offs[​](#risk--trade-offs "Direct link to Risk & trade-offs")

- This delegate is, for now, only compatible with ETH as terminal token.
- This delegate relies on the liquidity available in an Uniswap V3. If LP migrate to a new pool or another DEX, this delegate would need to be redeployed.
- A low liquidity might, if the max slippage isn't set properly, lead to an actual amount of token received lower than expected.

[Edit this page](https://github.com/jbx-protocol/juice-docs/blob/main/docs/dev/extensions/juice-buyback/README.md)

[

Previous

JBTiered721GovernanceDelegate

](/dev/extensions/juice-721-delegate/jbtiered721governancedelegate/)[

Next

JBBuybackDelegateOperations

](/dev/extensions/juice-buyback/libraries/jbbuybackdelegateoperations/)

- [Summary](#summary)
- [Design](#design)
    - [Flow](#flow)
    - [Contracts/Interfaces](#contractsinterfaces)
- [Usage](#usage)
- [Use-case](#use-case)
- [Risk & trade-offs](#risk--trade-offs)