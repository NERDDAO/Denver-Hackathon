[Skip to main content](#__docusaurus_skipToContent_fallback)

[

![Juicebox Logo](https://docs.juicebox.money/dev/extensions/juice-721-delegate//img/logo/main-logo-black.svg)

](/)[Docs](/dev/)[Project Creators](/user/)[JuiceboxDAO](/dao/)

[Blogs](/blogs/)

- [For Project Creators](/blog/)
- [Updates](/updates/)
- [Town Halls](/town-hall/)
- [Miscellaneous](/misc/)

[English](#)

- [English](/dev/extensions/juice-721-delegate/)
- [中文](/zh/dev/extensions/juice-721-delegate/)

[Links](#)

- [Juicebox](https://juicebox.money)
- [Contact](https://juicebox.money/contact)
- [Discord](https://discord.gg/juicebox)
- [GitHub](https://github.com/jbx-protocol)
- [Telegram](https://t.me/jbx_eth)
- [Governance](https://jbdao.org)
- [Analytics](/dao/reference/analytics/)
- [Twitter](https://twitter.com/juiceboxETH)
- [YouTube](https://www.youtube.com/c/JuiceboxDAO/)
- [Newsletter](https://subscribepage.io/juicenews)
- [Podcast](https://anchor.fm/thejuicecast)

Search⌘K

- [Intro](/dev/)
- [Learn](#)
    
    - [Overview](/dev/learn/overview/)
    - [Architecture](/dev/learn/architecture/)
        
        - [Payment Terminals](/dev/learn/architecture/terminals/)
    - [Administration](/dev/learn/administration/)
    - [Risks](/dev/learn/risks/)
    - [Glossary](/dev/learn/glossary/)
        
        - [Ballot](/dev/learn/glossary/ballot/)
        - [Data source](/dev/learn/glossary/data-source/)
        - [Delegate](/dev/learn/glossary/delegate/)
        - [Discount rate](/dev/learn/glossary/discount-rate/)
        - [Funding cycle](/dev/learn/glossary/funding-cycle/)
        - [Hold fees](/dev/learn/glossary/hold-fees/)
        - [NFT Rewards](/dev/learn/glossary/nft-rewards/)
        - [Operator](/dev/learn/glossary/operator/)
        - [Overflow](/dev/learn/glossary/overflow/)
        - [Payment terminal](/dev/learn/glossary/payment-terminal/)
        - [Project](/dev/learn/glossary/project/)
        - [Redemption rate](/dev/learn/glossary/redemption-rate/)
        - [Reserved tokens](/dev/learn/glossary/reserved-tokens/)
        - [Split allocator](/dev/learn/glossary/split-allocator/)
        - [Splits](/dev/learn/glossary/splits/)
        - [Token Store](/dev/learn/glossary/token-store/)
        - [Tokens](/dev/learn/glossary/tokens/)
- [Build](#)
    
    - [Getting started](/dev/build/getting-started/)
    - [Basics](/dev/build/basics/)
    - [Project NFT](/dev/build/project-nft/)
    - [Programmable treasury](/dev/build/programmable-treasury/)
    - [Treasury extensions](/dev/build/treasury-extensions/)
        
        - [Ballot](/dev/build/treasury-extensions/ballot/)
        - [Data source](/dev/build/treasury-extensions/data-source/)
        - [Pay delegate](/dev/build/treasury-extensions/pay-delegate/)
        - [Redemption delegate](/dev/build/treasury-extensions/redemption-delegate/)
        - [Split allocator](/dev/build/treasury-extensions/split-allocator/)
    - [Utilities](#)
        
        - [Project payer](/dev/build/utilities/project-payer/)
        - [Splits payer](/dev/build/utilities/splits-payer/)
    - [Namespaces & IDs](/dev/build/namespace/)
    - [Contract Examples](/dev/build/examples/)
- [API](#)
    
    - [Data Structures](#)
        
        - [JBDidPayData](/dev/api/data-structures/jbdidpaydata/)
        - [JBDidPayData3_1_1](/dev/api/data-structures/jbdidpaydata3_1_1/)
        - [JBDidRedeemData](/dev/api/data-structures/jbdidredeemdata/)
        - [JBDidRedeemData3_1_1](/dev/api/data-structures/jbdidredeemdata3_1_1/)
        - [JBFee](/dev/api/data-structures/jbfee/)
        - [JBFundAccessConstraints](/dev/api/data-structures/jbfundaccessconstraints/)
        - [JBFundingCycle](/dev/api/data-structures/jbfundingcycle/)
        - [JBFundingCycleData](/dev/api/data-structures/jbfundingcycledata/)
        - [JBFundingCycleMetadata](/dev/api/data-structures/jbfundingcyclemetadata/)
        - [JBGlobalFundingCycleMetadata](/dev/api/data-structures/jbglobalfundingcyclemetadata/)
        - [JBGroupedSplits](/dev/api/data-structures/jbgroupedsplits/)
        - [JBOperatorData](/dev/api/data-structures/jboperatordata/)
        - [JBPayDelegateAllocation](/dev/api/data-structures/jbpaydelegateallocation/)
        - [JBPayDelegateAllocation3_1_1](/dev/api/data-structures/jbpaydelegateallocation3_1_1/)
        - [JBPayParamsData](/dev/api/data-structures/jbpayparamsdata/)
        - [JBProjectMetadata](/dev/api/data-structures/jbprojectmetadata/)
        - [JBRedeemParamsData](/dev/api/data-structures/jbredeemparamsdata/)
        - [JBRedemptionDelegateAllocation](/dev/api/data-structures/jbredemptiondelegateallocation/)
        - [JBRedemptionDelegateAllocation3_1_1](/dev/api/data-structures/jbredemptiondelegateallocation3_1_1/)
        - [JBSplit](/dev/api/data-structures/jbsplit/)
        - [JBSplitAllocationData](/dev/api/data-structures/jbsplitallocationdata/)
        - [JBTokenAmount](/dev/api/data-structures/jbtokenamount/)
    - [Enums](#)
        
        - [JBBallotState](/dev/api/enums/jbballotstate/)
        - [JBFeeType](/dev/api/enums/jbfeetype/)
    - [Libraries](#)
        
        - [JBConstant](/dev/api/libraries/jbconstants/)
        - [JBCurrencies](/dev/api/libraries/jbcurrencies/)
        - [JBFixedPointNumber](/dev/api/libraries/jbfixedpointnumber/)
        - [JBFundingCycleMetadataResolver](/dev/api/libraries/jbfundingcyclemetadataresolver/)
        - [JBGlobalFundingCycleMetadataResolver](/dev/api/libraries/jbglobalfundingcyclemetadataresolver/)
        - [JBOperations](/dev/api/libraries/jboperations/)
        - [JBOperations2](/dev/api/libraries/jboperations2/)
        - [JBSplitsGroups](/dev/api/libraries/jbsplitsgroups/)
        - [JBTokens](/dev/api/libraries/jbtokens/)
    - [Interfaces](#)
        
        - [IJBAllowanceTerminal3_1](/dev/api/interfaces/ijballowanceterminal3_1/)
        - [IJBController3_1](/dev/api/interfaces/ijbcontroller3_1/)
        - [IJBControllerUtility](/dev/api/interfaces/ijbcontrollerutility/)
        - [IJBDirectory](/dev/api/interfaces/ijbdirectory/)
        - [IJBETHERC20ProjectPayerDeployer](/dev/api/interfaces/ijbetherc20projectpayerdeployer/)
        - [IJBETHERC20SplitsPayerDeployer](/dev/api/interfaces/ijbetherc20splitspayerdeployer/)
        - [IJBFeeGauge](/dev/api/interfaces/ijbfeegauge/)
        - [IJBFeeGauge3_1](/dev/api/interfaces/ijbfeegauge3_1/)
        - [IJBFeeHoldingTerminal](/dev/api/interfaces/ijbfeeholdingterminal/)
        - [IJBFundAccessConstraintsStore](/dev/api/interfaces/ijbfundaccessconstraintsstore/)
        - [IJBFundingCycleBallot](/dev/api/interfaces/ijbfundingcycleballot/)
        - [IJBFundingCycleDataSource](/dev/api/interfaces/ijbfundingcycledatasource/)
        - [IJBFundingCycleDataSource3_1_1](/dev/api/interfaces/ijbfundingcycledatasource3_1_1/)
        - [IJBFundingCycleStore](/dev/api/interfaces/ijbfundingcyclestore/)
        - [IJBMigratable](/dev/api/interfaces/ijbmigratable/)
        - [IJBOperatable](/dev/api/interfaces/ijboperatable/)
        - [IJBOperatorStore](/dev/api/interfaces/ijboperatorstore/)
        - [IJBPayDelegate](/dev/api/interfaces/ijbpaydelegate/)
        - [IJBPayDelegate3_1_1](/dev/api/interfaces/ijbpaydelegate3_1_1/)
        - [IJBPaymentTerminal](/dev/api/interfaces/ijbpaymentterminal/)
        - [IJBPayoutRedemptionPaymentTerminal3_1](/dev/api/interfaces/ijbpayoutredemptionpaymentterminal3_1/)
        - [IJBPayoutRedemptionPaymentTerminal3_1_1](/dev/api/interfaces/ijbpayoutredemptionpaymentterminal3_1_1/)
        - [IJBPayoutTerminal3_1](/dev/api/interfaces/ijbpayoutterminal3_1/)
        - [IJBPriceFeed](/dev/api/interfaces/ijbpricefeed/)
        - [IJBPrices](/dev/api/interfaces/ijbprices/)
        - [IJBProjectHandles](/dev/api/interfaces/ijbprojecthandles/)
        - [IJBProjectPayer](/dev/api/interfaces/ijbprojectpayer/)
        - [IJBProjects](/dev/api/interfaces/ijbprojects/)
        - [IJBRedemptionDelegate](/dev/api/interfaces/ijbredemptiondelegate/)
        - [IJBRedemptionDelegate3_1_1](/dev/api/interfaces/ijbredemptiondelegate3_1_1/)
        - [IJBRedemptionTerminal](/dev/api/interfaces/ijbredemptionterminal/)
        - [IJBSingleTokenPaymentTerminal](/dev/api/interfaces/ijbsingletokenpaymentterminal/)
        - [IJBSingleTokenPaymentTerminalStore](/dev/api/interfaces/ijbsingletokenpaymentterminalstore/)
        - [IJBSingleTokenPaymentTerminalStore3_1_1](/dev/api/interfaces/ijbsingletokenpaymentterminalstore3_1_1/)
        - [IJBSplitAllocator](/dev/api/interfaces/ijbsplitallocator/)
        - [IJBSplitsPayer](/dev/api/interfaces/ijbsplitspayer/)
        - [IJBSplitsStore](/dev/api/interfaces/ijbsplitsstore/)
        - [IJBTerminalUtility](/dev/api/interfaces/ijbterminalutility/)
        - [IJBToken](/dev/api/interfaces/ijbtoken/)
        - [IJBTokenStore](/dev/api/interfaces/ijbtokenstore/)
        - [IJBTokenUriResolver](/dev/api/interfaces/ijbtokenuriresolver/)
        - [IJBV1TokenPaymentTerminal](/dev/api/interfaces/ijbv1tokenpaymentterminal/)
    - [Contracts](/dev/api/contracts/)
        
        - [JBProjects](/dev/api/contracts/jbprojects/)
            
            - [Events](#)
                
            - [Properties](#)
                
            - [Read](#)
                
            - [Write](#)
                
        - [JBTokenStore](/dev/api/contracts/jbtokenstore/)
            
        - [JBFundingCycleStore](/dev/api/contracts/jbfundingcyclestore/)
            
        - [JBSplitsStore](/dev/api/contracts/jbsplitsstore/)
            
        - [JBPrices](/dev/api/contracts/jbprices/)
            
        - [JBOperatorStore](/dev/api/contracts/jboperatorstore/)
            
        - [JBToken](/dev/api/contracts/jbtoken/)
            
        - [JBDirectory](/dev/api/contracts/jbdirectory/)
            
        - [JBFundAccessConstraintsStore](/dev/api/contracts/jbfundaccessconstraintsstore/)
        - [JBSingleTokenPaymentTerminalStore3_1](/dev/api/contracts/jbsingletokenpaymentterminalstore3_1/)
        - [JBSingleTokenPaymentTerminalStore3_1_1](/dev/api/contracts/jbsingletokenpaymentterminalstore3_1_1/)
        - [| Payment terminals](#)
            
            - [| Abstract](#)
                
            - [JBERC20PaymentTerminal3_1](/dev/api/contracts/or-payment-terminals/jberc20paymentterminal3_1/)
            - [JBERC20PaymentTerminal3_1_1](/dev/api/contracts/or-payment-terminals/jberc20paymentterminal3_1_1/)
            - [JBERC20PaymentTerminal3_1_2](/dev/api/contracts/or-payment-terminals/jberc20paymentterminal3_1_2/)
            - [JBETHPaymentTerminal3_1](/dev/api/contracts/or-payment-terminals/jbethpaymentterminal3_1/)
            - [JBETHPaymentTerminal3_1_1](/dev/api/contracts/or-payment-terminals/jbethpaymentterminal3_1_1/)
            - [JBETHPaymentTerminal3_1_2](/dev/api/contracts/or-payment-terminals/jbethpaymentterminal3_1_2/)
            - [JBV1TokenPaymentTerminal](/dev/api/contracts/or-payment-terminals/jbv1tokenpaymentterminal/)
                
        - [| Controllers](#)
            
            - [JBController3_1](/dev/api/contracts/or-controllers/jbcontroller3_1/)
        - [| Price Feeds](#)
            
        - [| Ballots](#)
            
        - [| Utilities](#)
            
        - [| Abstract](#)
            
- [Extensions](#)
    
    - [ERC-721 Delegate](/dev/extensions/juice-721-delegate/)
        
        - [Abstract](#)
            
            - [ERC721](/dev/extensions/juice-721-delegate/abstract/erc721/)
            - [JB721Delegate](/dev/extensions/juice-721-delegate/abstract/jb721delegate/)
            - [Votes](/dev/extensions/juice-721-delegate/abstract/votes/)
        - [Enums](#)
            
            - [JB721GovernanceType](/dev/extensions/juice-721-delegate/enums/jb721governancetype/)
        - [Interfaces](#)
            
        - [Libraries](#)
            
        - [Structs](#)
            
        - [JBTiered721Delegate](/dev/extensions/juice-721-delegate/jbtiered721delegate/)
        - [JBTiered721DelegateDeployer](/dev/extensions/juice-721-delegate/jbtiered721delegatedeployer/)
        - [JBTiered721DelegateProjectDeployer](/dev/extensions/juice-721-delegate/jbtiered721delegateprojectdeployer/)
        - [JBTiered721DelegateStore](/dev/extensions/juice-721-delegate/jbtiered721delegatestore/)
        - [JBTiered721GovernanceDelegate](/dev/extensions/juice-721-delegate/jbtiered721governancedelegate/)
    - [Buyback Delegate](/dev/extensions/juice-buyback/)
        
        - [Libraries](#)
            
        - [Interfaces](#)
            
        - [JBBuybackDelegate](/dev/extensions/juice-buyback/jbbuybackdelegate/)
        - [JBGenericBuybackDelegate](/dev/extensions/juice-buyback/jbgenericbuybackdelegate/)
    - [JBDelegateMetadataLib](/dev/extensions/juice-delegate-metadata-lib/)
        
        - [Constants](/dev/extensions/juice-delegate-metadata-lib/jbdelegatemetadataconstants/)
        - [JBDelegateMetadataHelper](/dev/extensions/juice-delegate-metadata-lib/jbdelegatemetadatahelper/)
        - [JBDelegateMetadataLib](/dev/extensions/juice-delegate-metadata-lib/jbdelegatemetadatalib/)
    - [Delegate Registry](/dev/extensions/juice-delegates-registry/)
        
    - [Juice Ownable](/dev/extensions/juice-ownable/)
        
    - [NFT Token Resolver](/dev/extensions/juice-token-resolver/)
        
        - [TokenUriResolver](/dev/extensions/juice-token-resolver/tokenuriresolver/)
        - [DefaultTokenUriResolver](/dev/extensions/juice-token-resolver/defaulttokenuriresolver/)
        - [Interfaces](#)
            
        - [Libraries](#)
            
        - [Data Structures](#)
            
    - [V3 Migration](/dev/extensions/juice-v3-migration/)
        
        - [JBV3Token](/dev/extensions/juice-v3-migration/jbv3token/)
        - [JBV3TokenDeployer](/dev/extensions/juice-v3-migration/jbv3tokendeployer/)
        - [V1Allocator](/dev/extensions/juice-v3-migration/v1allocator/)
        - [V2Allocator](/dev/extensions/juice-v3-migration/v2allocator/)
- [Resources](#)
    
    - [Contract Addresses](/dev/resources/addresses/)
    - [Contribute](/dev/resources/contribute/)
    - [Security & Audits](/dev/resources/security/)
    - [Post Mortems](#)
        
    - [Versioning History](/dev/resources/versioning/)
- [Frontend](/dev/frontend/)
    
- [Deprecated](#)
    

- [](/)
- Extensions
- ERC-721 Delegate

On this page

# ERC-721 Delegate

info

This is the README from the [`juice-721-delegate`](https://github.com/jbx-protocol/juice-721-delegate.git) repository.

## Motivation[​](#motivation "Direct link to Motivation")

If included in a project's funding cycle, a 721 Delegate can provide utility or incentive for contributors to participate.

## Mechanic[​](#mechanic "Direct link to Mechanic")

Within one collection, NFTs can be minted within any number of pre-programmed tiers.

Each tier has the following optional properties:

- a price.
- a max quantity.
- optionally, a number of voting units to associate with each unit within the tier, with onchain historical records.
- optionally, a reserved rate allowing a proportion of units within the tier to be minted to a pre-programmed beneficiary.
- a token URI, overridable by a URI resolver that can return dynamic values for each unit with the tier.
- a category, so tiers can be organized and accessed for different purposes.
- optionally, the ability for the contract's owner to mint tokens from the tier on demand.
- if the tokens within the tier can have transfers paused on a per-funding-cycle basis, or if they must always remain transferable.
- a few additional flags that restrict future tier additions to the collection.

New tiers can be added, so long as they respect the contract's `flags` that specify if new tiers can influence voting units, reserved quantities, or be manually minted.

Tiers can also be removed, so long as they are not locked.

An incoming payment can specify any number of tiers to mint as part of the payment, so long as the sum of the tier's prices are contained within the paid amount. If specific tiers aren't specified, the best available tier will be minted based on the specified floor amount, unless a flag is specifically sent along with the payment telling the contract to not mint.

If a tier's price is specified in a currency different to the incoming payment, a `JBPrices` contract will by used for trying to normalize the values.

If a payment received does not meet a price threshold or is in excess of the minted tiers, the balance is stored as a credit which will be added to future payments and applied to mints at that time. A flag can also be passed to avoid accepting payments that aren't applied to mints in full.

The contract's owner can mint on demand from tier's that have been pre-programmed to allow manual token minting.

The NFTs from each tier can also be used for redemptions against the underlying Juicebox treasury. The rate of redemptions corresponds to the price floor of the tier being redeemed, compared to the total price floors of all minted NFTs. Fungible project tokens cannot be being redeemed at the same time. In order to activate NFT redemptions, turn on the `shouldUseDataSourceForRedeem` metadata flag of your next funding cycle.

The NFTs can serve as utilities for on-chain governance if specified during the collection's deployment.

## Architecture[​](#architecture "Direct link to Architecture")

An understanding of how the Juicebox protocol's pay and redeem functionality works is an important prereq to understanding how this repo's contracts work and attach themselves to Juicebox's regular operating behavior. This contract specifically makes use of the DataSource+Delegate pattern. See [https://info.juicebox.money/dev/](https://info.juicebox.money/dev/).

In order to use a 721 delegate, a Juicebox project should be launched from `JBTiered721DelegateProjectDeployer` instead of a `JBController`. This Deployer will deploy a `JBTiered721Delegate` (through it's reference to a `JBTiered721DelegateDeployer`) and attach it to the first funding cycle of the newly launched project as a DataSource and Delegate. Funding cycle reconfigurations can also be done using the `JBTiered721DelegateProjectDeployer`, though it will need to have Operator permissions from the project's owner.

The abstract `JB721Delegate` implementation of the ERC721 Juicebox DataSource+Delegate extension can be used for any distribution mechanic. This repo includes one implementation – the `JBTiered721Delegate` – as well as an extensions that offer on-chain governance capabilities to the distributed tokens.

All `JBTiered721Delegate`'s use a generic `JBTiered721DelegateStore` to store it's data.

The pay metadata structure is as follows: bytes32: ignored bytes32: ignored bytes4: send 0xf8b169f8 if the behavior from this delegate is expected to be triggered. bool: A flag indicating if the transaction should be allowed to proceed even if more funds are being paid than the specified NFTs cost. uint16[]: A list of tier IDs to mint from.

## Deploy[​](#deploy "Direct link to Deploy")

The deployer copies the data of a pre-existing cononical version of the 721 contracts, which can be either GlobalGovernance, TierGovernance, or no governance. This was done to keep the deployer contract size small enough to be deployable, without the extra cost of the delegatecalls associated with a proxy pattern.

# Install

Quick all-in-one command:

```
rm -Rf juice-721-delegate || true && git clone -n https://github.com/jbx-protocol/juice-721-delegate && cd juice-721-delegate && git pull origin f9893b1497098241dd3a664956d8016ff0d0efd0 && git checkout FETCH_HEAD && foundryup && git submodule update --init --recursive --force && yarn install && forge test --gas-report
```

To get set up:

1. Install [Foundry](https://github.com/gakonst/foundry).

```
curl -L https://foundry.paradigm.xyz | sh
```

2. Install external lib(s)

```
yarn install
```

then run

```
forge update
```

3. Run tests:

```
forge test
```

4. Update Foundry periodically:

```
foundryup
```

#### Setup[​](#setup "Direct link to Setup")

Configure the .env variables, and add a mnemonic.txt file with the mnemonic of the deployer wallet. The sender address in the .env must correspond to the mnemonic account.

## Goerli[​](#goerli "Direct link to Goerli")

```
yarn deploy-goerli
```

## Mainnet[​](#mainnet "Direct link to Mainnet")

```
yarn deploy-mainnet
```

The deployments are stored in ./broadcast

See the [Foundry Book for available options](https://book.getfoundry.sh/reference/forge/forge-create.html).

[Edit this page](https://github.com/jbx-protocol/juice-docs/blob/main/docs/dev/extensions/juice-721-delegate/README.md)

[

Previous

_requirePermissionAllowingOverride

](/dev/api/contracts/or-abstract/jboperatable/read/-_requirepermissionallowingoverride/)[

Next

ERC721

](/dev/extensions/juice-721-delegate/abstract/erc721/)

- [Motivation](#motivation)
- [Mechanic](#mechanic)
- [Architecture](#architecture)
- [Deploy](#deploy)
    - [Setup](#setup)
- [Goerli](#goerli)
- [Mainnet](#mainnet)